___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Posthog Events - Server Side",
  "categories": ["ANALYTICS", "SESSION_RECORDING", "HEAT_MAP", "DATA_WAREHOUSING"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "Posthog",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Send Google Tag Manager Server Side events to Posthog using their \u003ca href\u003d\"https://posthog.com/docs/api/post-only-endpoints\"\u003ePOST-only public endpoints\u003c/a\u003e.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "posthogProjectAPIKey",
    "displayName": "Enter your Project API Key",
    "simpleValueType": true,
    "help": "You can obtain your Project API Key from your account\u0027s Settings page.",
    "notSetText": "A Project API Key is required."
  },
  {
    "type": "SELECT",
    "name": "posthogEndPointSelection",
    "displayName": "Select your version of PostHog",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "cloud",
        "displayValue": "PostHog Cloud"
      },
      {
        "value": "custom",
        "displayValue": "PostHog Self-Host"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "SELECT",
    "name": "posthogCloudAccountURL",
    "displayName": "Select the hostname of your PostHog account",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "app",
        "displayValue": "app.posthog.com"
      },
      {
        "value": "eu",
        "displayValue": "eu.posthog.com"
      }
    ],
    "simpleValueType": true,
    "help": "By default your account hostname, and therefore your API endpoint hostname, will be \u003cstrong\u003eapp.posthog.com\u003c/strong\u003e. However, if located in the European Union, your account sub-domain will be set to \u003cstrong\u003eeu\u003c/strong\u003e resulting in a matching \u003cstrong\u003eeu.posthog.com\u003c/strong\u003e API endpoint.",
    "enablingConditions": [
      {
        "paramName": "posthogEndPointSelection",
        "paramValue": "cloud",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "posthogCustomEndpoint",
    "displayName": "Enter the full URL (protocol, hostname, and path) to your custom API endpoint",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "posthogEndPointSelection",
        "paramValue": "custom",
        "type": "EQUALS"
      }
    ],
    "help": "Learn more about \u003ca href\u003d\"https://posthog.com/docs/self-host\"\u003eself-hosting Posthog\u003c/a\u003e"
  },
  {
    "type": "SELECT",
    "name": "posthogSelectDistinctIdSource",
    "displayName": "Select source of Distinct ID value",
    "selectItems": [
      {
        "value": "posthogCookieDistinctId",
        "displayValue": "PostHog Distinct ID cookie value"
      },
      {
        "value": "posthogCookieDeviceId",
        "displayValue": "PostHog Device ID cookie value"
      },
      {
        "value": "ga4ClientId",
        "displayValue": "GA4 Client ID"
      }
    ],
    "simpleValueType": true,
    "help": "The Distinct ID is required to send data server-side. However, once the data is set, \u003cstrong\u003eit can no longer be overwritten\u003c/strong\u003e. The selection can have a major impact on your analysis capabilities. \u003cstrong\u003eIf in doubt, please switch to a Web set up\u003c/strong\u003e which allows you to omit the Distinct ID when unkown.\u003c/ br\u003eSince this template is dependent on the GA4 client-side tag and server-side client \u003cstrong\u003ethe default Distinct ID value will be set to GA4\u0027s Client ID value\u003c/strong\u003e.",
    "notSetText": "- Select a source -",
    "alwaysInSummary": true,
    "defaultValue": "ga4ClientId"
  },
  {
    "type": "SELECT",
    "name": "posthogEventType",
    "displayName": "Select the PostHog Event Type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "customEvent",
        "displayValue": "Custom Event"
      },
      {
        "value": "pageView",
        "displayValue": "Pageview"
      }
    ],
    "simpleValueType": true,
    "help": "Read more about \u003ca href\u003d\"https://posthog.com/docs/integrate/client/js\"\u003eCustom Events\u003c/a\u003e."
  },
  {
    "type": "GROUP",
    "name": "posthogEventParametersGroup",
    "displayName": "Event Parameters",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SELECT",
        "name": "posthogEventNameDropdown",
        "displayName": "Select source of Event Name value",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "eventData",
            "displayValue": "event_name parameter in Event Data"
          },
          {
            "value": "customEventName",
            "displayValue": "Custom event name"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "posthogEventName",
        "displayName": "Enter the custom event name",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "posthogEventNameDropdown",
            "paramValue": "customEventName",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY",
            "enablingConditions": [],
            "errorMessage": "Please enter a custom event name."
          }
        ]
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "posthogEventParameters",
        "displayName": "Add event parameters",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Key",
            "name": "key",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "posthogEventType",
        "paramValue": "customEvent",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

// Test APIs
// const logToConsole = require('logToConsole');

// Core APIs
const sendHttpRequest = require('sendHttpRequest');
const JSON = require('JSON');
const getEventData = require('getEventData');
const parseUrl = require('parseUrl');
// const getRemoteAddress = require('getRemoteAddress');

// Core Variables
const projectApiKey = data.posthogProjectAPIKey;
let endpointUrl = "https://app.posthog.com/capture/";

// Determine API endpoint based on Posthog account type
if(data.posthogEndPointSelection !== "cloud") {
  endpointUrl = data.posthogCustomEndpoint;
}

if(data.posthogCloudAccountURL === "eu") {
  endpointUrl = "https://eu.posthog.com/capture/";
}

// Event Variables
let event_type = data.posthogEventType;
let event_name = getEventData("event_name");

if(event_type === "pageView") {
  event_name = "$pageview";
} else if(event_type === "customEvent") {
  event_name = data.posthogEventNameDropdown === "eventData" ? event_name : data.posthogEventName;
}

const posthogCookies = getEventData("posthog_cookies") || "";
const posthogCookiesObject = JSON.parse(posthogCookies);
let distinct_id_source = data.posthogSelectDistinctIdSource;
let distinct_id;

if (distinct_id_source === "posthogCookieDistinctId" && !!posthogCookiesObject.distinct_id) {
  distinct_id = posthogCookiesObject.distinct_id;
} else if (distinct_id_source === "posthogCookieDeviceId" && !!posthogCookiesObject["$device_id"]) {
  distinct_id = posthogCookiesObject["$device_id"];
} else {
  distinct_id = getEventData("client_id");
}

// Build Root API Object
let postBody = {
    "api_key": projectApiKey,
    "event": event_name,
    "distinct_id": distinct_id
};

// Build Event Parameters Object
let eventParametersObject = {};
if(data.posthogEventParameters && data.posthogEventParameters.length > 0) {
  const eventParameters = data.posthogEventParameters; 
  if(eventParameters.length > 0) {
    eventParameters.forEach(row => {
      eventParametersObject[row.key] = row.value;
    });
  }
}

// Build Other Parameters Object
const current_url = getEventData("page_location");
const currentUrlObject = parseUrl(current_url);
let screen_resolutions = getEventData("screen_resolution") || ["0","0"];

if(screen_resolutions.indexOf('x') > -1) {
  screen_resolutions = screen_resolutions.split('x');
}

let eventProperties = {
  "$session_id": posthogCookiesObject["$sesid"][1],
  "$current_url": current_url,
  "$device_id": posthogCookiesObject["$device_id"],
  "$host": currentUrlObject.hostname,
  "$pathname": currentUrlObject.pathname,
  "$referrer": posthogCookiesObject["$referrer"],
  "$referring_domain": currentUrlObject.pathname,
  "$screen_height": screen_resolutions[0],
  "$screen_width": screen_resolutions[1],
  "$useragent": getEventData("user_agent") || "",
  "$ip": getEventData("ip_override") || "",
  "language": getEventData("language") || "",
  "$lib": "api",
  "$active_feature_flags": posthogCookiesObject["$active_feature_flags"]
};

// Add info about enabled feature flags
posthogCookiesObject["$active_feature_flags"].forEach(flag => {
  const featureKey = "$feature/"+flag;
  const featureValue = posthogCookiesObject["$enabled_feature_flags"][flag];
  eventProperties[featureKey] = featureValue;
});

// Merge Event and Other Parameters Objects
const mergeObj = (fromObj, toObj) => {
  for (let key in fromObj) {
    if (fromObj.hasOwnProperty(key)) {
      toObj[key] = fromObj[key];
    }
  }
  return toObj;
};

postBody.properties = mergeObj(eventProperties, eventParametersObject);

// Send POST request
sendHttpRequest(endpointUrl, (statusCode, headers, body) => {
  if (statusCode >= 400) {
    data.gtmOnFailure();
  } else {
    data.gtmOnSuccess();
  }
}, {
  headers: {
    'content-type': 'application/json'
  },
  method: 'POST',
  timeout: 1000
}, JSON.stringify(postBody));


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 08/02/2023, 16:30:02


